#include "shellFunc.h"

void processPipe(char* process1, char* process2){	
	int pipeFD[2];	//create array to hold both file descriptor generated by pipe()
	pid_t pid;		//create a process id
	
	pipe(pipeFD);	//make the two pipes
	
	/*
	 * 
	 * PROCESS 1
	 * 
	 */
	 
	pid = fork();	//fork the process
	
	if(pid == 0){
		close(pipeFD[0]); //close the read end of the pipe
		if(pipeFD[1] != stdout) //if the pipeFD[1] is not already stdout
			dup2(pipeFD[1],stdout); //dup the pipeFD[1] to stdout
		close(pipeFD[1]);		//close the write end of the pipe
	}
	//handle redirection if there's any
	
	
	//parse arguments
	
	//test with process 1 being "ls -l"
	char *process1Args[] = {"ls", "-l"};
	
	execvp("ls",process1Args);
	
	
	
	/*
	 * 
	 * PROCESS 2
	 * 
	 */
	
	pid = fork(); //fork the process
	
	if(pid == 0){
		close(pipeFD[1]);	 //close the read end of the pipe
		if(pipeFD[0] !=  stdin)		//if the pipeFD[0] is not already stdin
			dup2(pipeFD[0],stdin); //dup the pipeFD[0] to stdin
		close(pipeFD[0]); //close the write end of the pipe
	}
	
	//handle redirection if there's any
	
	
	//parse arguments
	
	
	//test with process 2 being "ws -l"
	char *process2Args[] = {"wc", "-l"};
	
	execvp("wc",process2Args);
	
	//waitpid(pid);
}

void checkTok(char* tempTok, int pos, char** tokens){
	if(tempTok[0] == '>'){
		printf("redirecting output\n");
		int new_out = open(tokens[pos+1], O_WRONLY | O_CREAT, 0644);
		dup2(new_out, STDOUT_FILENO);
		printf("output redirected to %s\n", tokens[pos+1]);
	}
	else if(tempTok[0] == '<'){
		int new_in = open(tokens[pos-1], O_RDONLY);
		dup2(new_in, STDIN_FILENO);
		printf("input redirected\n");
	}
	else if(tempTok[0] == '|'){
		char* process1 = calloc(20, sizeof(char*));
		char* process2 = calloc(20, sizeof(char*));
		
		//get the first process string
		/*for(int i = 0; i < pos; i++){
			printf("pos: %i\n", pos);
			process1[i] = tokens[pos-1];
		}
			
		printf("This is process 1 %s\n", process1);
		for(int i = pos; i < sizeof(tokens); i++)
			process2[i] = tokens[pos-1];	
		printf("This is process 2 %s\n", process2);	
			*/
		printf("This is a pipe\n");
<<<<<<< HEAD
		int new_out = open("tempFile", O_WRONLY | O_CREAT, 0644);
		int new_in = new_out;
=======
		processPipe(process1, process2);
		///do something
>>>>>>> 8419ebea7f4ee04b9500a555546630ca0041c9d0
	}
	else
		//printf("Parse Error:");
		return;
	
	
}

int getTokens(char* input, char** tokens){
	//create tokenizer
	tokenizer = init_tokenizer(input);
	
	int i = 0;
	while((tok = get_next_token(tokenizer)) != NULL){
		tokens[i++] = tok;
		printf("token is: %s\n", tokens[i-1]);
	}
	
	//int j;
	//for(j = 0; j < i; j++){
		//checkTok(tokens[j], j, tokens);
		//printf("Token at %i is %s\n", j, tokens[j]);
	//}
	
	free_tokenizer(tokenizer);
	
	return i +1;

}

